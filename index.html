<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Racing de Santander - Home</title>
    <link rel="stylesheet" href="styles/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Oswald:wght@700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Header Component Placeholder -->
    <div id="header-placeholder"></div>

    <main>
      <section class="hero">
        <div class="hero-content">
          <h1>SOMOS RACING</h1>
          <h3>The heart of Cantabria beats here</h3>
        </div>
      </section>

      <!-- API-powered sections -->
      <section class="api-data-section">
        <div class="container">
          <div id="apiStatus" class="api-status" style="display: none"></div>

          <!-- League Position -->
          <div id="leaguePositionContainer" style="display: none">
            <h3>Current League Position</h3>
            <div id="leaguePositionContent"></div>
          </div>

          <!-- Upcoming Fixtures -->
          <div id="fixturesContainer" style="display: none">
            <h3>Upcoming Fixtures</h3>
            <div id="fixturesContent" class="fixtures-grid"></div>
          </div>

          <!-- Loading state -->
          <div id="loadingContainer" class="loading-container">
            <div class="loading-spinner"></div>
            <p class="loading-text">Loading match data...</p>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer Component Placeholder -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="js/components.js"></script>
    <script src="footballAPIData.js"></script>
    <script>
      // Home page functionality
      let fixturesData = [];
      let leaguePositionData = null;

      // Load data when page loads
      document.addEventListener("DOMContentLoaded", function () {
        loadMatchData();
      });

      async function loadMatchData() {
        const loadingContainer = document.getElementById("loadingContainer");
        const apiStatus = document.getElementById("apiStatus");
        const leaguePositionContainer = document.getElementById(
          "leaguePositionContainer"
        );
        const fixturesContainer = document.getElementById("fixturesContainer");

        // Show loading state
        loadingContainer.style.display = "block";
        apiStatus.style.display = "none";
        leaguePositionContainer.style.display = "none";
        fixturesContainer.style.display = "none";

        try {
          // Load both fixtures and league position
          const [fixtures, leaguePosition] = await Promise.all([
            racingAPI.getUpcomingFixtures(5),
            racingAPI.getLeaguePosition(),
          ]);

          fixturesData = fixtures;
          leaguePositionData = leaguePosition;

          // Check if we got real API data or fallback using the isLiveData flag
          const isLiveData =
            fixtures.isLiveData === true || leaguePosition.isLiveData === true;

          console.log(fixturesData);

          // Show API status
          apiStatus.style.display = "block";
          if (isLiveData) {
            apiStatus.className = "api-status live";
            apiStatus.textContent = "✓ Live data from API";
          } else {
            apiStatus.className = "api-status fallback";
            apiStatus.textContent = "⚠ Using fallback data (API unavailable)";
          }

          // Render data
          if (leaguePositionData) {
            renderLeaguePosition(leaguePositionData);
            leaguePositionContainer.style.display = "block";
          }

          if (fixturesData.length > 0) {
            renderFixtures(fixturesData);
            fixturesContainer.style.display = "block";
          }

          // Hide loading
          loadingContainer.style.display = "none";
        } catch (error) {
          console.error("Error loading match data:", error);
          loadingContainer.style.display = "none";
        }
      }

      function renderLeaguePosition(data) {
        const container = document.getElementById("leaguePositionContent");

        const html = `
          <div class="league-position-card">
            <div class="position-number">${data.position}</div>
            <div class="position-label">Current Position</div>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value">${data.points}</div>
                <div class="stat-label">Points</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${data.played}</div>
                <div class="stat-label">Played</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${data.won}</div>
                <div class="stat-label">Won</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${data.drawn}</div>
                <div class="stat-label">Drawn</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${data.lost}</div>
                <div class="stat-label">Lost</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">${data.goalDifference > 0 ? "+" : ""}${
          data.goalDifference
        }</div>
                <div class="stat-label">Goal Diff</div>
              </div>
            </div>
          </div>
        `;

        container.innerHTML = html;
      }

      function renderFixtures(fixtures) {
        const container = document.getElementById("fixturesContent");

        let html = "";

        fixtures.forEach((fixture) => {
          const date = new Date(fixture.date);
          const formattedDate = date.toLocaleDateString("en-GB", {
            weekday: "short",
            day: "numeric",
            month: "short",
          });
          const formattedTime = date.toLocaleTimeString("en-GB", {
            hour: "2-digit",
            minute: "2-digit",
          });

          html += `
            <div class="fixture-card">
              <div class="team-info">
                <div class="team-logo">
                  <img src="${fixture.homeLogo}" alt="${fixture.homeTeam}" onerror="this.style.display='none'; this.parentElement.innerHTML='🏠';">
                </div>
                <div class="team-name">${fixture.homeTeam}</div>
              </div>
              
              <div class="fixture-details">
                <div class="vs-text">VS</div>
                <div class="fixture-date">${formattedDate}</div>
                <div class="fixture-venue">${formattedTime}</div>
                <div class="fixture-competition">${fixture.competition}</div>
              </div>
              
              <div class="team-info">
                <div class="team-logo">
                  <img src="${fixture.awayLogo}" alt="${fixture.awayTeam}" onerror="this.style.display='none'; this.parentElement.innerHTML='⚽';">
                </div>
                <div class="team-name">${fixture.awayTeam}</div>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }
    </script>
  </body>
</html>

<style>
  /* API-powered sections */
  .api-data-section {
    background: var(--color-white);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin: 30px 0;
  }

  .api-data-section h3 {
    color: var(--color-green);
    font-size: 1.8rem;
    margin-bottom: 20px;
    text-align: center;
    border-bottom: 2px solid var(--color-green);
    padding-bottom: 10px;
  }

  .fixtures-grid {
    display: grid;
    gap: 15px;
  }

  .fixture-card {
    background: var(--color-grey-light);
    border-radius: 8px;
    padding: 20px;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s ease;
  }

  .fixture-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }

  .team-info {
    text-align: center;
  }

  .team-logo {
    width: 40px;
    height: 40px;
    margin: 0 auto 8px;
    border-radius: 50%;
    background: var(--color-white);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
  }

  .team-logo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
  }

  .team-name {
    font-weight: bold;
    color: var(--color-grey-dark);
    font-size: 0.9rem;
  }

  .fixture-details {
    text-align: center;
    color: var(--color-grey-dark);
  }

  .fixture-date {
    font-weight: bold;
    color: var(--color-green);
    margin-bottom: 5px;
  }

  .fixture-venue {
    font-size: 0.8rem;
    color: var(--color-grey-medium);
  }

  .fixture-competition {
    font-size: 0.8rem;
    color: var(--color-grey-medium);
    margin-top: 5px;
  }

  .vs-text {
    font-weight: bold;
    color: var(--color-green);
    font-size: 1.2rem;
  }

  .league-position-card {
    background: linear-gradient(135deg, var(--color-green), #007a2d);
    color: var(--color-white);
    border-radius: 12px;
    padding: 30px;
    text-align: center;
    margin-bottom: 20px;
  }

  .position-number {
    font-size: 4rem;
    font-weight: bold;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  }

  .position-label {
    font-size: 1.2rem;
    margin-bottom: 20px;
    opacity: 0.9;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }

  .stat-item {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }

  .stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 5px;
  }

  .stat-label {
    font-size: 0.8rem;
    opacity: 0.8;
  }

  .loading-container {
    text-align: center;
    padding: 40px 20px;
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--color-grey-light);
    border-top: 3px solid var(--color-green);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  .loading-text {
    color: var(--color-grey-dark);
    font-size: 1rem;
  }

  .api-status {
    text-align: center;
    margin-bottom: 20px;
    padding: 10px;
    border-radius: 5px;
    font-size: 0.9rem;
  }

  .api-status.live {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .api-status.fallback {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
  }

  @media (max-width: 768px) {
    .fixture-card {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .position-number {
      font-size: 3rem;
    }

    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
